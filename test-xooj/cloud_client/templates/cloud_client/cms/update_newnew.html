{% extends 'cms/iframe_layout.html' %}
{% load i18n %}
{% load static_v %}
{% load static %}

{% block title %}
    {% trans 'x_update' %}
{% endblock %}

{% block other_css_js %}
    <link rel="stylesheet" href="{% static 'cms/css/update.css' %}">
    <style>
        .update-img {
            position: absolute;
            left: -80px;
            top: -80px;
        }

        .modal-header {
            border-bottom: none;
        }

        .modal-footer {
            border-top: none;
            text-align: center;
        }

        .modal-footer > .btn-white {
            margin-bottom: 0;
        }

        .modal-body ol li {
            margin-bottom: 5px;
        }

        .caret-icon {
            min-width: 100px;
            text-align: right;
            color: #666;
            font-size: 18px;
        }

        .modal-body {
            padding: 20px 60px 30px;
            min-height: 320px;
        }

        .modal-body ol {
            padding-left: 17px;
        }

        .font14 {
            font-size: 14px;
        }

        .font18 {
            font-size: 18px;
        }

        .connect-fail, .progress-wrap {
            display: none;
            margin-top: 120px;
        }

        .progress, .progress-bar {
            border-radius: 10px;
        }
        .version{
            display: none;
        }
        .btn-w-m {
            border: 1px solid #1ab394;
        }
    </style>
    <script>
        //触发显示对话框
        $(function () {
            $('#check-update-modal').modal('show');
        });
        //配置model对话框
        $(function () {
            $('#check-update-modal').modal({"backdrop": "static"}).on("shown.bs.modal", function () {
                var $modal_dialog = $(this).find('.modal-dialog');
                //获取可视窗口的高度
                var clientHeight = (document.body.clientHeight < document.documentElement.clientHeight) ? document.body.clientHeight : document.documentElement.clientHeight;
                //得到dialog的高度
                var dialogHeight = $modal_dialog.height();
                //计算出距离顶部的高度
                var m_top = (clientHeight - dialogHeight) / 2;
                $modal_dialog.animate({
                    'marginTop': m_top
                }, 600)
            });
        });
    </script>

{% endblock %}

{% block container %}
    <div class="ibox-content">
        <div id="tableToolbar">
            <div class="form-group">
                <div class="clearfix">
                    <div class="col-md-6 col-sm-6">
                        <a class="btn btn-primary">
                            <i class="fa fa-plus"></i>{% trans 'x_load_offline_update' %}
                        </a>
                        <input type="file" class="hidden" id="env_file" name="env_file"/>
                        <span class="btn btn-primary file-upload-btn">{% trans 'x_upload' %}</span>
                        <span class="hint"></span>
                        <input type="file" class="hidden">
                    </div>
                </div>

                <div class="clearfix" style="margin-top: 30px">
                    <div class="col-md-6 col-sm-6">
                        <a>{% trans 'x_current_version' %}v3.1.1</a>
                        <a class="btn btn-primary">
                            <i class="fa"></i>{% trans 'x_check_update' %}
                        </a>
                    </div>
                </div>
                {#  版本信息          #}

                <div class="ibox float-e-margins">
                    <div class="no-padding">
                        <div class="panel-body">
                            <div class="panel-group" id="version">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h5 class="panel-title">
                                            <a href="">v4.1.0</a><span class="pull-right"><code>2015.12.21</code><i
                                                class="fa fa-caret-right caret-icon"></i></span>
                                        </h5>
                                    </div>
                                    <div class="panel-collapse collapse">
                                        <div class="panel-body">
                                            <div class="alert alert-warning">此版本是一个维护版本，主要是升级和修复bug，让我们共同期待5.0版的到来</div>
                                            <ol>
                                                <li>增加不支持IE8的页面提示</li>
                                                <li>修复页面链接和表单提交默认在新窗口中打开的问题</li>
                                                <li>更新suggest插件，修复错位问题</li>
                                                <li>升级bootstrap版本到3.3.6版本</li>
                                                <li>升级layer到2.1版本</li>
                                                <li>升级echarts到2.2.7版本</li>
                                                <li>升级webuploader到0.1.5版本</li>
                                                <li>修复网络条件不好情况下，页面加载提示遮挡页面无法操作的问题</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h5 class="panel-title">
                                            <a href="">v4.1.0</a><span class="pull-right"><code>2015.12.21</code><i
                                                class="fa fa-caret-right caret-icon"></i></span>
                                        </h5>
                                    </div>
                                    <div class="panel-collapse collapse">
                                        <div class="panel-body">
                                            <ol>
                                                <li>升级bootstrap到最新版本3.3.5；</li>
                                                <li>升级jquery版本到最新版本2.1.4；</li>
                                                <li>升级Font Awesome到最新版本4.4.0；</li>
                                                <li>修复了登录页面的一处错误；</li>
                                                <li>修复了主页面出现多个滚动条的问题；</li>
                                                <li>修复了已知的各种浏览器兼容问题；</li>
                                                <li>修复了layphoto和suggest等页面的显示问题；</li>
                                                <li>新增Glyphicons字体图标的预览；</li>
                                                <li>新增对不支持的浏览器的友好提示；</li>
                                                <li>新增视频/音乐播放器的支持；</li>
                                                <li>新增Bootstrap Table(推荐)；</li>
                                                <li>进一步完善了开发文档；</li>
                                                <li>提供了离线支持，开箱即用；</li>
                                                <li>对IE系列的浏览器支持更好。</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h5 class="panel-title">
                                            <a href="">v4.1.0</a><span class="pull-right"><code>2015.12.21</code><i
                                                class="fa fa-caret-right caret-icon"></i></span>
                                        </h5>
                                    </div>
                                    <div class="panel-collapse collapse">
                                        <div class="panel-body">
                                            <ol>
                                                <li>升级bootstrap到最新版本3.3.5；</li>
                                                <li>升级jquery版本到最新版本2.1.4；</li>
                                                <li>升级Font Awesome到最新版本4.4.0；</li>
                                                <li>修复了登录页面的一处错误；</li>
                                                <li>修复了主页面出现多个滚动条的问题；</li>
                                                <li>修复了已知的各种浏览器兼容问题；</li>
                                                <li>修复了layphoto和suggest等页面的显示问题；</li>
                                                <li>新增Glyphicons字体图标的预览；</li>
                                                <li>新增对不支持的浏览器的友好提示；</li>
                                                <li>新增视频/音乐播放器的支持；</li>
                                                <li>新增Bootstrap Table(推荐)；</li>
                                                <li>进一步完善了开发文档；</li>
                                                <li>提供了离线支持，开箱即用；</li>
                                                <li>对IE系列的浏览器支持更好。</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" role="dialog" id="check-update-modal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <img class="update-img" style="" src="{% static_v 'cms/img/update.png' %}">
                <div class="modal-header text-center">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h3 class="modal-title">{% trans 'x_find_new_version' %}</h3>
                </div>
                <div class="modal-body">
                    {#loading#}
                    <div class="load-wrap-wrap">
                        <div class="load-wrap">
                            <div class="load-container load5">
                                <div class="loader">Loading...</div>
                            </div>
                            <div class="text-center font18"><strong>Loading...</strong></div>
                        </div>
                    </div>
                    {#连接失败#}
                     <div class="connect-fail text-center"><strong
                                class="text-danger font18">服务器连接失败，请稍后再试...</strong></div>
                    {#  版本更新#}
                    <div class="version">
                        <p><strong>3.0.0.1 {% trans 'x_version_update' %}</strong></p>
                        <ol>
                            <li>对IE系列的浏览器支持更好对IE系列的浏览器支持更好对IE系列的浏览器支持更好</li>
                            <li>对IE系列的浏览器支持更好</li>
                            <li>对IE系列的浏览器支持更好</li>
                        </ol>
                        <strong class="font14">
                            <p>本次版本更新较大，暂不支持在线更新！</p>
                            <p>请联系我们进行线下更新，联系电话：<span class="text-navy">400-1234567</span>。</p>
                        </strong>
                    </div>
                    {# 进度条#}
                    <div class="progress-wrap">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="40"
                                 aria-valuemin="0" aria-valuemax="100" style="width: 70%">
                            </div>
                        </div>
                        <div class="text-center font18"><strong>正在升级...</strong></div>
                    </div>

                </div>


                <div class="modal-footer">
                    <button type="button" class="btn btn-w-m btn-white" data-dismiss="modal">
                        {% trans 'x_cancel' %}
                    </button>
                    <button type="button" class="btn btn-w-m btn-primary"
                            onclick="update()">{% trans 'x_update_now' %}</button>
                </div>


            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
{% endblock %}

{% block bottom_js %}
    <script type="text/javascript">
        $('.caret-icon').on('click', function () {
            if ($(this).hasClass('fa-caret-right')) {
                $(this).removeClass('fa-caret-right').addClass('fa-caret-down');
                $(this).parent().parent().parent().next().addClass('in');
                $(this).parent().parent().parent().parent().siblings().find('.caret-icon').removeClass('fa-caret-down').addClass('fa-caret-right');
                $(this).parent().parent().parent().parent().siblings().find('.panel-collapse').removeClass('in');
            } else {
                $(this).removeClass('fa-caret-down').addClass('fa-caret-right');
                $(this).parent().parent().parent().next().removeClass('in');
            }
        });

        setTimeout(function () {
            $('.load-wrap').fadeOut(200);
        }, 5000);
        setTimeout(function () {
            $('.connect-fail').fadeIn(200);
        }, 6000);

        setTimeout(function () {
            $('.version').fadeIn(200);
            if ($('.version').is(':visible')) {
                $('.connect-fail').fadeOut(200);
            }
        }, 7000);
        function update() {
            $('.load-wrap-wrap,.version').fadeOut(200);
            $('.progress-wrap').fadeIn(200);
        }
    </script>
{% endblock %}